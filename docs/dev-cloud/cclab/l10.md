Alright, I've scrubbed the notes of any external links and meta-references. Here is the clean, updated version of the guide.

---

# AWS Virtual Private Cloud (VPC)

## 1. Introduction to VPC

An AWS Virtual Private Cloud (VPC) is a logically isolated section of the AWS Cloud. It's where you can launch your AWS resources (like EC2 instances or databases) into a virtual network that you define.

It's a virtual network dedicated to your AWS account. This gives you complete control over the networking environment, including your own IP address ranges, subnets, route tables, and network gateways—similar to having your own private data center inside AWS.

### 1.1. Default VPC vs. Custom VPC

|**Feature**|**Default VPC**|**Custom VPC**|
|---|---|---|
|**Best For**|Beginners, quick testing, learning environments, or temporary setups.|Production environments, enterprise setups, or multi-tier architectures.|
|**Creation**|Created automatically by AWS in each region.|Created manually by the user.|
|**Ready to Use**|Yes, you can launch EC2 instances immediately—no setup needed.|Requires manual configuration of subnets, gateways, and route tables.|
|**CIDR Block**|Always uses `172.31.0.0/16`.|User-defined IP range (e.g., `10.0.0.0/16`).|
|**Subnets**|One default public subnet in each Availability Zone.|User-defined subnets (public or private).|
|**Internet Connectivity**|Pre-configured with an Internet Gateway.|Requires manual creation and attachment of an Internet Gateway.|
|**Route Table**|Automatically configured to provide internet access.|Must be created and configured manually.|
|**Security**|Comes with default Security Groups and Network ACLs.|Requires manual creation of custom Security Groups and NACLs.|

---

## 2. Core Components of a VPC

|**Component**|**Description**|
|---|---|
|**CIDR Block (IP Range)**|The overall range of IP addresses for your VPC (e.g., `10.0.0.0/16`).|
|**Subnets**|Smaller divisions inside your VPC, each tied to one Availability Zone.<br><br>  <br><br>* **Public Subnet:** Has a route to an Internet Gateway; for web servers.<br><br>  <br><br>* **Private Subnet:** No direct internet access; for databases or internal apps.|
|**Internet Gateway (IGW)**|A gateway that connects your VPC to the Internet. It's required for resources in a public subnet to receive internet traffic and must be attached to the VPC.|
|**Route Tables**|A set of rules (routes) that determine where network traffic is directed. Each subnet must be associated with one route table.<br><br>  <br><br>* **Public Route:** `0.0.0.0/0` $\rightarrow$ Internet Gateway.<br><br>  <br><br>* **Private Route:** `0.0.0.0/0` $\rightarrow$ NAT Gateway.|
|**NAT Gateway**|Enables instances in a private subnet to connect _out_ to the internet (e.g., for software updates) without being exposed to _inbound_ traffic. It is deployed inside a public subnet and requires an Elastic IP.|
|**Security Groups (SG)**|An instance-level firewall controlling inbound and outbound traffic.<br><br>  <br><br>* **Stateful:** If inbound traffic is allowed, the corresponding outbound (return) traffic is automatically allowed.<br><br>  <br><br>* **Example:** A `WebServer-SG` allows HTTP (80) and SSH (22), while a `Database-SG` allows MySQL (3306) only from the `WebServer-SG`.|
|**Network ACLs (NACL)**|A subnet-level firewall that acts as an additional layer of security.<br><br>  <br><br>* **Stateless:** Inbound and outbound rules must be defined separately.<br><br>  <br><br>* The default NACL allows all traffic.|
|**Elastic IP (EIP)**|A static, public IPv4 address. It's used for NAT Gateways or servers that need a fixed public IP, as it remains constant even if an instance is stopped.|
|**VPC Peering**|Connects two VPCs so they can communicate privately as if they are on the same network.|

---

## 3. Practical Guide: Building a Two-Tier VPC Architecture

This guide provides a step-by-step process for designing and configuring a VPC for a two-tier web application.

**Objective:**

- Create one **Public Subnet** for web servers (using an **Internet Gateway**).
    
- Create one **Private Subnet** for databases (using a **NAT Gateway**).
    
- Configure separate **Route Tables** for each subnet.
    
- Implement custom **Security Groups** to enforce network isolation.
    

### Step 1: Create a New VPC

1. Navigate to the **VPC Dashboard** in the AWS Management Console.
    
2. Click **Create VPC**.
    
3. Select the **VPC only** option.
    
4. Enter the following details:
    
    - **Name tag**: `MyWebAppVPC`
        
    - **IPv4 CIDR block**: `10.0.0.0/16`
        
    - **Tenancy**: `Default`
        
5. Click **Create VPC**.
    

### Step 2: Create Subnets

#### a) Public Subnet

1. Go to **Subnets** and click **Create subnet**.
    
2. Select the VPC you created: `MyWebAppVPC`.
    
3. Enter the following details:
    
    - **Subnet name**: `PublicSubnet`
        
    - **Availability Zone**: Choose one (e.g., `ap-south-1a`).
        
    - **IPv4 CIDR block**: `10.0.1.0/24`
        
4. Click **Create subnet**.
    

#### b) Private Subnet

1. Click **Create subnet** again.
    
2. Select the same VPC: `MyWebAppVPC`.
    
3. Enter the following details:
    
    - **Subnet name**: `PrivateSubnet`
        
    - **Availability Zone**: Choose a different one for high availability (e.g., `ap-south-1b`).
        
    - **IPv4 CIDR block**: `10.0.2.0/24`
        
4. Click **Create subnet**.
    

### Step 3: Create and Attach an Internet Gateway (IGW)

1. Go to **Internet Gateways** and click **Create Internet Gateway**.
    
2. Enter a **Name tag**: `MyWebApp-IGW`.
    
3. Click **Create Internet Gateway**.
    
4. Select the newly created IGW, click **Actions**, and choose **Attach to VPC**.
    
5. Select `MyWebAppVPC` and click **Attach Internet Gateway**.
    

### Step 4: Create a NAT Gateway

1. Go to **NAT Gateways** and click **Create NAT Gateway**.
    
2. Enter the following details:
    
    - **Name**: `MyWebApp-NATGW`
        
    - **Subnet**: `PublicSubnet` (NAT Gateways live in a public subnet).
        
    - **Elastic IP Allocation ID**: Click **Allocate new Elastic IP**.
        
3. Click **Create NAT Gateway**.
    
    - _Note: NAT Gateways are a paid resource_.
        

### Step 5: Configure Route Tables

#### a) Public Route Table

1. Go to **Route Tables** and click **Create route table**.
    
2. Enter the following details:
    
    - **Name**: `PublicRT`
        
    - **VPC**: `MyWebAppVPC`
        
3. Click **Create route table**.
    
4. Select `PublicRT`, go to the **Routes** tab, and click **Edit routes**.
    
5. Click **Add route**, and enter:
    
    - **Destination**: `0.0.0.0/0`
        
    - **Target**: `Internet Gateway` $\rightarrow$ `MyWebApp-IGW`
        
6. Save the routes.
    
7. Go to the **Subnet associations** tab, click **Edit subnet associations**, select `PublicSubnet`, and click **Save associations**.
    

#### b) Private Route Table

1. Create another route table:
    
    - **Name**: `PrivateRT`
        
    - **VPC**: `MyWebAppVPC`
        
2. Select `PrivateRT`, go to the **Routes** tab, and click **Edit routes**.
    
3. Click **Add route**, and enter:
    
    - **Destination**: `0.0.0.0/0`
        
    - **Target**: `NAT Gateway` $\rightarrow$ `MyWebApp-NATGW`
        
4. Save the routes.
    
5. Go to the **Subnet associations** tab, click **Edit subnet associations**, select `PrivateSubnet`, and click **Save associations**.
    

> **Note:** Each subnet can be associated with only one route table. If a subnet isn't explicitly associated, it automatically uses the **Main Route Table**.

### Step 6: Create Security Groups

#### a) WebServer Security Group

1. Go to **Security Groups** and click **Create security group**.
    
2. Enter the following details:
    
    - **Security group name**: `WebServer-SG`
        
    - **Description**: `Allow HTTP, HTTPS, SSH`
        
    - **VPC**: `MyWebAppVPC`
        
3. Add the following Inbound rules:

| **Type** | **Protocol** | **Port Range** | **Source** |
| -------- | ------------ | -------------- | ---------- |
| SSH      | TCP          | 22             | My IP      |
| HTTP     | TCP          | 80             | 0.0.0.0/0  |
| HTTPS    | TCP          | 443            | 0.0.0.0/0  |

	    
4. Click **Create security group**.
    

#### b) Database Security Group

1. Create another security group:
    
    - **Security group name**: `Database-SG`
        
    - **Description**: `Allow MySQL/Aurora from WebServer-SG`
        
    - **VPC**: `MyWebAppVPC`
        
2. Add the following Inbound rule (this enforces least-privilege).    

| **Type**     | **Protocol** | **Port Range** | **Source**                               |
| ------------ | ------------ | -------------- | ---------------------------------------- |
| MySQL/Aurora | TCP          | 3306           | `WebServer-SG` (Select the WebServer-SG) |
 
3. Click **Create security group**.
    

### Step 7: Launch EC2 Instances

#### a) Web Server in Public Subnet

1. Go to **EC2** and click **Launch Instance**.
    
2. Choose an AMI (e.g., Amazon Linux 2).
    
3. In **Network settings**, select:
    
    - **VPC**: `MyWebAppVPC`
        
    - **Subnet**: `PublicSubnet`
        
    - **Auto-assign Public IP**: **Enable**
        
    - **Firewall (security groups)**: `Select existing security group` $\rightarrow$ `WebServer-SG`
        
4. Launch the instance.
    

#### b) Database Server in Private Subnet

1. Launch another EC2 instance.
    
2. In **Network settings**, select:
    
    - **VPC**: `MyWebAppVPC`
        
    - **Subnet**: `PrivateSubnet`
        
    - **Auto-assign Public IP**: **Disable**
        
    - **Firewall (security groups)**: `Select existing security group` $\rightarrow$ `Database-SG`
        
3. Launch the instance.
    

### Step 8: Testing and Verification

1. **Connect to Web Server:** Connect via SSH using its public IP address (e.g., `ssh -i key.pem ec2-user@<public-ip>`).
    
2. **Test Web Server Internet:** From the Web Server, try to install a package (e.g., `sudo yum update -y`). This **should succeed** because it's in the public subnet with a route to the IGW.
    
3. **Test Internal Connectivity:** From the Web Server, try to ping the **Database Server's private IP** (e.g., `ping <db-private-ip>`). This **should succeed**, as both instances are in the same VPC.
    
4. **Test Private Instance Outbound Access:** From the Database Server (which you'd have to connect to via the Web Server first, using it as a "bastion host"), try to ping an external site. This **should NOT work** if only testing with `ping`, as `ping` (ICMP) may be blocked by default. A better test, like `curl` to an external site or `sudo yum update -y`, _would_ work, proving the NAT Gateway is functioning for TCP traffic.